{% extends 'base.html.twig' %}

{% block title %}EcoRide - Voyager{% endblock %}

{% block importmap %}
    {{ importmap(['app', 'travel.css']) }}
{% endblock %}

{% block main %}
{% if map %}
    {{ ux_map(map, {'id': 'map'}) }}
{% endif %}

<div class="eco-container-main d-flex flex-column gap-3">

    {% include 'partials/_flashes.html.twig' %}

    <article class="travel-card travel-card-show">
        {# Date #}
        <div class="ga-date eco-small-text justify-self-center">
            <time datetime="{{ travel.date | date('Y-m-d H:i') }}">{{ travel.date | format_datetime(locale='fr', pattern='EEEE d MMMM Y') }}</time>
        </div>

        {# Schedule #}
        <div class="ga-schedule">
            {% include 'travel/partials/_schedule.html.twig' with {
                date: travel.date,
                duration: travel.duration,
                arrivalDateTime: arrivalDateTime
            } %}
        </div>

        {# Passengers #}
        <div class="ga-places">
            {{ ux_icon('ion:people', {class: 'h-75'}) }}
            <p class="eco-bold-text">{{ usedSlots }}/{{ travel.passengersMax }}</p>
        </div>

        {# Addresses #}
        <div class="ga-address">
            <p>{{ travel.departure }}</p>
            <p>{{ travel.arrival }}</p>
        </div>

        {# Properties #}
        <div class="ga-properties">
            {% include('travel/partials/_properties.html.twig') with {
                ecologic: travel.car.fuelType.value == 'electric',
                animals: travel.getTravelPreference().isPetsAllowed(),
                smoking: travel.getTravelPreference().isSmokingAllowed(),
                luggage: travel.getTravelPreference().getLuggageSizeEnum()
            } %}
        </div>
    </article>

    <article id="driver">
        <h2 class="h2 eco-normal-text eco-bold-text">Conducteur :</h2>
        <section class="user-card">
            <a class="ga-user-img" href="{{ path('app_member_show', { uuid: travel.driver.uuid }) }}" target="_blank">
                {% include('partials/_user_img.html.twig') with {
                        username: travel.driver.username,
                } %}
            </a>

            <div class="ga-user-resume d-flex gap-2">
                <p class="eco-bold-text m-0">{{ travel.driver.username }}</p>
                {% if travel.driver.ratingAverage > 0 %}
                    <p class="d-inline-flex">{{ ux_icon('ion:star', {class: 'icon h-16'}) }}{{ travel.driver.ratingAverage }}</p>
                {% endif %}
                <a href="#">({{driverReviewsCount}} avis)</a>
            </div>

            <p class="ga-user-bio">{{ travel.driver.bio }}</p>

        </section>
    </article>

    {% if driverReviews %}
    <article id="reviews">
        <h2 class="h2 eco-normal-text eco-bold-text" type="button" data-bs-toggle="collapse" data-bs-target="#reviews-collapse" aria-expanded="false" aria-controls="reviews-collapse">Derniers avis {{ ux_icon('ion:chevron-down', {class: 'icon'}) }}</h2>
        <section id="reviews-collapse" class="collapse">
            <div class="d-flex flex-column gap-2 p-3">
                {% for review in driverReviews %}
                <div class="border-bottom pb-2">
                    <p class="eco-normal-text eco-bold-text"> {{ ux_icon('ion:star', {class: 'icon h-16'}) }} {{ review.rate }} Le {{ review.createdAt | date('d/m/Y') }} par <a href="{{ path('app_member_show', { uuid: review.author.uuid }) }}" target="_blank">{{ review.author.username }}</a></p>
                    <p>{{ review.content }}</p>
                </div>
                {% endfor %}

                <a href="#">voir plus</a>
            </div>
        </section>
    </article>
    {% endif %}

    <article id="car">
        <h2 class="h2 eco-normal-text eco-bold-text">Véhicule :</h2>
        <section class="p-3">
            <p>{{ travel.car.brand }} {{ travel.car.model }} - {{ travel.car.color.value }}</p>
            <p>{{ travel.car.fuelType.value }} - {{ travel.car.totalSeats }} places</p>
        </section>
    </article>

    <article id="comment">
        <h2 class="h2 eco-normal-text eco-bold-text">Commentaire du conducteur :</h2>
        <section class="p-3">
            <p>{{ travel.travelPreference.comment }}</p>
        </section>
    </article>

    <article class="travel-interaction">
        <form action="" method="POST" class="ga-message">
            <button type="submit" class="eco-btn eco-normal-text color-interact">
                Envoyer un message
            </button>
        </form>

        <div class="ga-price">
            {% include 'travel/partials/_price.html.twig' with {
                cost: travel.cost,
                slot: slot
            } %}
        </div>
        <form action="{{ path('app_travel_book', { 'uuid': travel.uuid }) }}" method="POST" class="ga-book">
            <input type="hidden" name="slot" value="{{ slot }}">
            <button type="submit" class="eco-btn eco-normal-text">
                Réserver {{ slot }} place{% if slot > 1 %}s{% endif %}
            </button>
        </form>
    </article>
</div>
{% endblock %}